{{/* 리액션 버튼 - Applause Button (로그인 불필요, 1일 1회 제한) */}}

{{ if site.Params.reactions }}
<div class="reactions">
  <link rel="stylesheet" href="https://unpkg.com/applause-button/dist/applause-button.css" />
  <script src="https://unpkg.com/applause-button/dist/applause-button.js"></script>
  <div class="reaction-wrapper">
    <applause-button
      id="applause-btn"
      style="width: 48px; height: 48px;"
      color="{{ site.Params.reactions.color | default "var(--brand-primary)" }}"
    />
    <span class="reaction-label" id="reaction-label">{{ site.Params.reactions.label | default "이 글이 도움이 되었나요?" }}</span>
  </div>
</div>
<script>
(function() {
  var KEY_PREFIX = 'applause_';
  var COOLDOWN_MS = 24 * 60 * 60 * 1000;
  var pageKey = KEY_PREFIX + location.pathname;
  var btn = document.getElementById('applause-btn');
  var label = document.getElementById('reaction-label');
  if (!btn || !label) return;

  function isLocked() {
    try {
      var ts = localStorage.getItem(pageKey);
      if (!ts) return false;
      return (Date.now() - Number(ts)) < COOLDOWN_MS;
    } catch(e) { return false; }
  }

  function lock() {
    try { localStorage.setItem(pageKey, String(Date.now())); } catch(e) {}
  }

  function showLocked() {
    btn.classList.add('reacted');
    label.textContent = '{{ site.Params.reactions.lockedLabel | default "오늘 이미 반응했어요!" }}';
  }

  if (isLocked()) {
    showLocked();
  }

  btn.addEventListener('clapped', function() {
    if (isLocked()) return;
    lock();
    label.textContent = '{{ site.Params.reactions.thanksLabel | default "감사합니다!" }}';
    setTimeout(showLocked, 2000);
  });

  btn.addEventListener('mousedown', function(e) {
    if (isLocked()) {
      e.preventDefault();
      e.stopPropagation();
      label.textContent = '{{ site.Params.reactions.lockedLabel | default "오늘 이미 반응했어요!" }}';
    }
  }, true);
})();
</script>
{{ end }}
